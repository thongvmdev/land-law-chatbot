### ğŸ›‘ PHáº¦N 1: CHIáº¾N LÆ¯á»¢C CHUNKING (LOGIC Xá»¬ LÃ NÃ‚NG CAO)

## Cáº¥u trÃºc tá»•ng thá»ƒ

1.  **ChÆ°Æ¡ng (Chapter):** LÃ  cáº¥p lá»›n nháº¥t.

    - [cite_start]TÃ i liá»‡u cÃ³ **16 ChÆ°Æ¡ng**[cite: 3326].
    - [cite_start]VÃ­ dá»¥: _ChÆ°Æ¡ng I: Quy Ä‘á»‹nh chung_ [cite: 17-18][cite_start], _ChÆ°Æ¡ng XVI: Äiá»u khoáº£n thi hÃ nh_[cite: 3326].

2.  **Má»¥c (Section):** LÃ  cáº¥p con cá»§a ChÆ°Æ¡ng (nhÆ°ng khÃ´ng báº¯t buá»™c).

    - [cite_start]**CÃ³ Má»¥c:** _ChÆ°Æ¡ng II_ Ä‘Æ°á»£c chia thÃ nh _Má»¥c 1_ [cite: 212][cite_start], _Má»¥c 2_ [cite: 296][cite_start], _Má»¥c 3_[cite: 337].
    - [cite_start]**KhÃ´ng cÃ³ Má»¥c:** _ChÆ°Æ¡ng I_ Ä‘i tháº³ng vÃ o cÃ¡c Äiá»u (Äiá»u 1 Ä‘áº¿n Äiá»u 11) mÃ  khÃ´ng chia Má»¥c [cite: 19-20].

3.  **Äiá»u (Article):** LÃ  Ä‘Æ¡n vá»‹ phÃ¡p lÃ½ cÆ¡ báº£n nháº¥t, Ä‘Æ°á»£c Ä‘Ã¡nh sá»‘ liÃªn tá»¥c toÃ n vÄƒn báº£n.

    - Tá»•ng cá»™ng cÃ³ **260 Äiá»u**.
    - Äiá»u náº±m trá»±c tiáº¿p trong ChÆ°Æ¡ng (náº¿u ChÆ°Æ¡ng khÃ´ng cÃ³ Má»¥c) hoáº·c náº±m trong Má»¥c.
    - [cite_start]VÃ­ dá»¥: _Äiá»u 79_ [cite: 1182] náº±m trong ChÆ°Æ¡ng VI.

4.  **Khoáº£n (Clause):** CÃ¡c Ä‘oáº¡n vÄƒn Ä‘Æ°á»£c Ä‘Ã¡nh sá»‘ (1, 2, 3...) trong má»™t Äiá»u.

    - [cite_start]VÃ­ dá»¥: _Äiá»u 176_ cÃ³ 7 Khoáº£n [cite: 2666-2678].

5.  **Äiá»ƒm (Point):** CÃ¡c Ã½ nhá» Ä‘Æ°á»£c Ä‘Ã¡nh kÃ½ tá»± (a, b, c...) trong má»™t Khoáº£n.

    - [cite_start]VÃ­ dá»¥: Táº¡i _Khoáº£n 3 Äiá»u 176_ cÃ³ 2 Ä‘iá»ƒm lÃ  _a) Äáº¥t rá»«ng phÃ²ng há»™_ vÃ  _b) Äáº¥t rá»«ng sáº£n xuáº¥t lÃ  rá»«ng trá»“ng_ [cite: 2670-2671].
    - [cite_start]LÆ°u Ã½: KhÃ´ng pháº£i Khoáº£n nÃ o cÅ©ng cÃ³ Äiá»ƒm (vÃ­ dá»¥ _Khoáº£n 2 Äiá»u 176_ chá»‰ lÃ  vÄƒn báº£n liá»n máº¡ch [cite: 2668]).

## CÃ¡c pháº§n cáº§n lÆ°u Ã½

_ÄÃ¢y lÃ  cÃ¡c á»©ng viÃªn sÃ¡ng giÃ¡ Ä‘á»ƒ kiá»ƒm tra logic cáº¯t "Äiá»u $\rightarrow$ Khoáº£n" vÃ  ká»¹ thuáº­t ná»‘i tiÃªu Ä‘á» (Prepend)._

---

### 1. Táº¡i sao cáº§n Gá»˜P? (TrÆ°á»ng há»£p Khoáº£n ngáº¯n)

[cite_start]**VÃ­ dá»¥ thá»±c táº¿:** **Khoáº£n 3 Äiá»u 176** vá» háº¡n má»©c giao Ä‘áº¥t [cite: 2670-2671].

- **Ná»™i dung gá»‘c:**
  > 3. Háº¡n má»©c giao Ä‘áº¥t cho cÃ¡ nhÃ¢n khÃ´ng quÃ¡ 30 ha Ä‘á»‘i vá»›i má»—i loáº¡i Ä‘áº¥t:
  >    a) Äáº¥t rá»«ng phÃ²ng há»™;
  >    b) Äáº¥t rá»«ng sáº£n xuáº¥t lÃ  rá»«ng trá»“ng.

#### âŒ Náº¿u báº¡n TÃ¡ch (Split) mÃ¡y mÃ³c:

Báº¡n sáº½ cÃ³ 2 chunk con:

1.  _"Äiá»ƒm a) Äáº¥t rá»«ng phÃ²ng há»™"_
2.  _"Äiá»ƒm b) Äáº¥t rá»«ng sáº£n xuáº¥t lÃ  rá»«ng trá»“ng"_

> **Háº­u quáº£:** Chunk quÃ¡ ngáº¯n vÃ  **máº¥t ngá»¯ nghÄ©a**. Náº¿u ngÆ°á»i dÃ¹ng há»i _"Háº¡n má»©c giao Ä‘áº¥t rá»«ng phÃ²ng há»™ lÃ  bao nhiÃªu?"_, chunk 1 khÃ´ng há» chá»©a tá»« khÃ³a "háº¡n má»©c" hay con sá»‘ "30 ha". Vector Search sáº½ bá» qua nÃ³ vÃ¬ khÃ´ng tháº¥y liÃªn quan.

#### âœ… Náº¿u báº¡n Gá»™p (Merge):

Báº¡n cÃ³ 1 chunk duy nháº¥t:

> _"Äiá»u 176... Khoáº£n 3. Háº¡n má»©c giao Ä‘áº¥t cho cÃ¡ nhÃ¢n khÃ´ng quÃ¡ 30 ha Ä‘á»‘i vá»›i má»—i loáº¡i Ä‘áº¥t: a) Äáº¥t rá»«ng phÃ²ng há»™; b) Äáº¥t rá»«ng sáº£n xuáº¥t lÃ  rá»«ng trá»“ng."_

> **Lá»£i Ã­ch:** Chunk chá»©a trá»n váº¹n thÃ´ng tin: **Äá»‘i tÆ°á»£ng** (Äáº¥t rá»«ng phÃ²ng há»™) + **Quy Ä‘á»‹nh** (30 ha). AI tÃ¬m tháº¥y ngay láº­p tá»©c.

---

### 2. Táº¡i sao cáº§n TÃCH? (TrÆ°á»ng há»£p Khoáº£n dÃ i/Liá»‡t kÃª)

[cite_start]**VÃ­ dá»¥ thá»±c táº¿:** **Khoáº£n 1 Äiá»u 137** vá» Giáº¥y tá» cáº¥p Sá»• Ä‘á» [cite: 2119-2141].
Khoáº£n nÃ y liá»‡t kÃª tá»›i **14 Ä‘iá»ƒm** (tá»« a Ä‘áº¿n n), chá»©a ráº¥t nhiá»u loáº¡i giáº¥y tá» khÃ¡c nhau (Giáº¥y tá» cháº¿ Ä‘á»™ cÅ©, Sá»• má»¥c kÃª, Giáº¥y tá» quÃ¢n Ä‘á»™i...).

#### âŒ Náº¿u báº¡n Gá»™p (Merge):

Báº¡n nhá»“i nhÃ©t cáº£ 14 loáº¡i giáº¥y tá» vÃ o 1 chunk khá»•ng lá»“ (~1000 tokens).

> **Háº­u quáº£ - "Pha loÃ£ng Vector" (Vector Dilution):**
> NgÆ°á»i dÃ¹ng há»i: _"Báº±ng khoÃ¡n Ä‘iá»n thá»• cÃ³ Ä‘Æ°á»£c cáº¥p sá»• khÃ´ng?"_
> Vector cá»§a cÃ¢u há»i táº­p trung vÃ o **"Báº±ng khoÃ¡n Ä‘iá»n thá»•"**. NhÆ°ng vector cá»§a chunk gá»™p láº¡i lÃ  trung bÃ¬nh cá»™ng cá»§a cáº£ "Giáº¥y tá» quÃ¢n Ä‘á»™i", "Sá»• má»¥c kÃª", "Di dÃ¢n kinh táº¿ má»›i"...
> $\rightarrow$ Äá»™ tÆ°Æ¡ng Ä‘á»“ng (Similarity Score) bá»‹ kÃ©o tháº¥p xuá»‘ng, dáº«n Ä‘áº¿n viá»‡c tÃ¬m kiáº¿m kÃ©m chÃ­nh xÃ¡c.

#### âœ… Náº¿u báº¡n TÃ¡ch (Split) vÃ  Ná»‘i gá»‘c:

Báº¡n táº¡o ra chunk riÃªng cho **Äiá»ƒm b**:

> [cite_start]_"Äiá»u 137... Khoáº£n 1... Ä‘Æ°á»£c cáº¥p Giáº¥y chá»©ng nháº­n...: Äiá»ƒm b) Má»™t trong cÃ¡c giáº¥y tá»... gá»“m: Báº±ng khoÃ¡n Ä‘iá»n thá»•; VÄƒn tá»± Ä‘oáº¡n mÃ£i..."_ [cite: 2121-2122].

> **Lá»£i Ã­ch:** Chunk nÃ y **Ä‘áº·c thÃ¹ hÃ³a** cho tá»« khÃ³a "Báº±ng khoÃ¡n Ä‘iá»n thá»•". Vector cá»§a nÃ³ sáº½ khá»›p cá»±c máº¡nh vá»›i cÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng.

---

### 3. Táº¡i sao Báº®T BUá»˜C pháº£i "Ná»‘i gá»‘c" (Prepend Context)?

[cite_start]**VÃ­ dá»¥ thá»±c táº¿:** **Khoáº£n 27 Äiá»u 79** [cite: 1260-1261].

#### âŒ Náº¿u báº¡n TÃ¡ch nhÆ°ng QUÃŠN ná»‘i gá»‘c:

Ná»™i dung chunk chá»‰ lÃ :

> _"27. Thá»±c hiá»‡n dá»± Ã¡n Ä‘áº§u tÆ° xÃ¢y dá»±ng khu Ä‘Ã´ thá»‹ cÃ³ cÃ´ng nÄƒng phá»¥c vá»¥ há»—n há»£p..."_

> **Háº­u quáº£ - "Máº¥t Ä‘áº§u máº¥t Ä‘uÃ´i":**
> AI Ä‘á»c vÃ o sáº½ hiá»ƒu Ä‘Ã¢y lÃ  má»™t hÃ nh Ä‘á»™ng: "Äi xÃ¢y khu Ä‘Ã´ thá»‹".
> NhÆ°ng thá»±c táº¿ luáº­t quy Ä‘á»‹nh Ä‘Ã¢y lÃ  trÆ°á»ng há»£p **NhÃ  nÆ°á»›c THU Há»’I Äáº¤T**. Náº¿u thiáº¿u cá»¥m tá»« "Thu há»“i Ä‘áº¥t", AI sáº½ tÆ° váº¥n sai nghiÃªm trá»ng (vÃ­ dá»¥: tÆ°á»Ÿng Ä‘Ã¢y lÃ  quy Ä‘á»‹nh vá» quy hoáº¡ch hoáº·c cáº¥p phÃ©p Ä‘áº§u tÆ°).

#### âœ… Khi Ã¡p dá»¥ng Ná»‘i gá»‘c (Prepend):

Ná»™i dung chunk trá»Ÿ thÃ nh:

> _"Äiá»u 79. Thu há»“i Ä‘áº¥t Ä‘á»ƒ phÃ¡t triá»ƒn kinh táº¿ - xÃ£ há»™i... NhÃ  nÆ°á»›c thu há»“i Ä‘áº¥t trong trÆ°á»ng há»£p...: Khoáº£n 27. Thá»±c hiá»‡n dá»± Ã¡n Ä‘áº§u tÆ° xÃ¢y dá»±ng khu Ä‘Ã´ thá»‹..."_

> **Lá»£i Ã­ch:** Chunk nÃ y kháº³ng Ä‘á»‹nh rÃµ rÃ ng: XÃ¢y khu Ä‘Ã´ thá»‹ lÃ  má»™t lÃ½ do Ä‘á»ƒ **Thu há»“i Ä‘áº¥t**. AI sáº½ tráº£ lá»i chÃ­nh xÃ¡c vá» tÃ­nh phÃ¡p lÃ½.

---

### TÃ³m táº¯t chiáº¿n lÆ°á»£c Adaptive

| TrÆ°á»ng há»£p           | Äáº·c Ä‘iá»ƒm trong File PDF     | HÃ nh Ä‘á»™ng   | Táº¡i sao?                                                             |
| :------------------- | :-------------------------- | :---------- | :------------------------------------------------------------------- |
| **Khoáº£n 3 Äiá»u 176** | Ngáº¯n, Ã­t Ä‘iá»ƒm (a, b)        | **Gá»˜P**     | Giá»¯ liÃªn káº¿t giá»¯a "Háº¡n má»©c 30ha" vÃ  "Rá»«ng phÃ²ng há»™".                 |
| **Khoáº£n 1 Äiá»u 137** | DÃ i, nhiá»u Ä‘iá»ƒm (a...n)     | **TÃCH**    | GiÃºp tÃ¬m kiáº¿m chÃ­nh xÃ¡c tá»«ng loáº¡i giáº¥y tá» cá»¥ thá»ƒ (trÃ¡nh nhiá»…u).      |
| **Khoáº£n 27 Äiá»u 79** | Má»™t má»¥c trong danh sÃ¡ch dÃ i | **Ná»I Gá»C** | Gáº¯n "Thu há»“i Ä‘áº¥t" vÃ o "Khu Ä‘Ã´ thá»‹" Ä‘á»ƒ Ä‘áº£m báº£o Ä‘Ãºng báº£n cháº¥t phÃ¡p lÃ½. |

| Äiá»u luáº­t   | Chá»§ Ä‘á»                       | Äá»™ dÃ i / Cáº¥u trÃºc                                              | Ghi chÃº Test                                                   |
| :---------- | :--------------------------- | :------------------------------------------------------------- | :------------------------------------------------------------- |
| **Äiá»u 3**  | Giáº£i thÃ­ch tá»« ngá»¯            | [cite_start]**49 Khoáº£n** (Tá»« khoáº£n 1 Ä‘áº¿n 49) [cite: 25-105]    | Kiá»ƒm tra kháº£ nÄƒng xá»­ lÃ½ sá»‘ lÆ°á»£ng chunk lá»›n trong 1 Ä‘iá»u.       |
| **Äiá»u 79** | Thu há»“i Ä‘áº¥t phÃ¡t triá»ƒn KT-XH | [cite_start]**32 Khoáº£n** (Tá»« khoáº£n 1 Ä‘áº¿n 32) [cite: 1184-1266] | Kiá»ƒm tra logic tÃ¡ch danh sÃ¡ch liá»‡t kÃª vÃ  ná»‘i lá»i dáº«n cáº¥p Äiá»u. |
| **Äiá»u 4**  | NgÆ°á»i sá»­ dá»¥ng Ä‘áº¥t            | [cite_start]7 Khoáº£n (CÃ³ khoáº£n chá»©a Ä‘iá»ƒm a, b) [cite: 106-120]  | Kiá»ƒm tra há»—n há»£p vá»«a liá»‡t kÃª khoáº£n, vá»«a lá»“ng Ä‘iá»ƒm.             |
| **Äiá»u 9**  | PhÃ¢n loáº¡i Ä‘áº¥t                | [cite_start]5 Khoáº£n (Khoáº£n 2 vÃ  3 ráº¥t dÃ i) [cite: 156-188]     | Kiá»ƒm tra phÃ¢n loáº¡i nhÃ³m Ä‘áº¥t.                                   |

### 2. CÃ¡c Khoáº£n chá»©a danh sÃ¡ch Äiá»ƒm ráº¥t dÃ i (Nested Points a, b, c...)

_ÄÃ¢y lÃ  cÃ¡c trÆ°á»ng há»£p báº¯t buá»™c pháº£i dÃ¹ng logic **"Äá»‡ quy" (Recursive Stemming)** Ä‘á»ƒ cáº¯t sÃ¢u xuá»‘ng cáº¥p Äiá»ƒm, náº¿u khÃ´ng chunk sáº½ quÃ¡ lá»›n hoáº·c máº¥t ngá»¯ nghÄ©a._

| Vá»‹ trÃ­ (Äiá»u - Khoáº£n) | Chá»§ Ä‘á»                       | Cáº¥u trÃºc Äiá»ƒm                         | Nguá»“n             | Ghi chÃº Test                                                                                                |
| :-------------------- | :--------------------------- | :------------------------------------ | :---------------- | :---------------------------------------------------------------------------------------------------------- |
| **Äiá»u 28, Khoáº£n 1**  | NgÆ°á»i nháº­n quyá»n sá»­ dá»¥ng Ä‘áº¥t | [cite_start]**15 Äiá»ƒm** (tá»« a Ä‘áº¿n o)  | [cite: 400-427]   | Danh sÃ¡ch ráº¥t dÃ i cÃ¡c Ä‘á»‘i tÆ°á»£ng nháº­n quyá»n.                                                                 |
| **Äiá»u 124, Khoáº£n 3** | Giao Ä‘áº¥t khÃ´ng Ä‘áº¥u giÃ¡       | [cite_start]**16 Äiá»ƒm** (tá»« a Ä‘áº¿n p)  | [cite: 1933-1951] | CÃ¡c trÆ°á»ng há»£p ngoáº¡i lá»‡ khÃ´ng Ä‘áº¥u giÃ¡. Cáº§n test ká»¹ lá»i dáº«n.                                                 |
| **Äiá»u 137, Khoáº£n 1** | Cáº¥p sá»• Ä‘á» (Ä‘áº¥t cÃ³ giáº¥y tá»)   | [cite_start]**14 Äiá»ƒm** (tá»« a Ä‘áº¿n n)  | [cite: 2119-2141] | CÃ¡c loáº¡i giáº¥y tá» cÅ©. Test xem há»‡ thá»‘ng cÃ³ nháº­n diá»‡n Ä‘Æ°á»£c cÃ¡c loáº¡i giáº¥y tá» láº¡ (Báº±ng khoÃ¡n, vÄƒn tá»±...) khÃ´ng. |
| **Äiá»u 157, Khoáº£n 1** | Miá»…n, giáº£m tiá»n sá»­ dá»¥ng Ä‘áº¥t  | [cite_start]**13 Äiá»ƒm** (tá»« a Ä‘áº¿n m)  | [cite: 2430-2454] | Danh sÃ¡ch Æ°u Ä‘Ã£i tÃ i chÃ­nh.                                                                                 |
| **Äiá»u 79, Khoáº£n 21** | Thu há»“i Ä‘áº¥t lÃ m nhÃ  á»Ÿ        | [cite_start]Má»™t Ä‘oáº¡n vÄƒn dÃ i, nhiá»u Ã½ | [cite: 1245-1248] | Kiá»ƒm tra xem script cÃ³ cáº¯t nháº§m khi cÃ¢u vÄƒn dÃ i nhÆ°ng khÃ´ng xuá»‘ng dÃ²ng khÃ´ng.                               |

### 3. CÃ¡c trÆ°á»ng há»£p Ä‘áº·c biá»‡t khÃ¡c (Edge Cases)

- [cite_start]**Äiá»u 217 (Äáº¥t do NhÃ  nÆ°á»›c quáº£n lÃ½):** Khoáº£n 1 liá»‡t kÃª tá»« a Ä‘áº¿n k [cite: 3051-3061]. ÄÃ¢y lÃ  danh sÃ¡ch Ä‘á»‹nh nghÄ©a quan trá»ng.
- [cite_start]**Äiá»u 148 (Cáº¥p sá»• cho nhÃ  á»Ÿ):** Khoáº£n 1 liá»‡t kÃª giáº¥y tá» nhÃ  á»Ÿ tá»« a Ä‘áº¿n g [cite: 2313-2322]. LÆ°u Ã½ cÃ³ cÃ¡c Nghá»‹ quyáº¿t sá»‘ Ä‘an xen trong vÄƒn báº£n.
- [cite_start]**Äiá»u 223 (Thá»§ tá»¥c hÃ nh chÃ­nh):** Khoáº£n 1 liá»‡t kÃª tá»« a Ä‘áº¿n k [cite: 3129-3137].

## Triá»ƒn khai

#### 1\. Quy trÃ¬nh LÃ m sáº¡ch (Cleaning Strategy)

TrÆ°á»›c khi cáº¯t, vÄƒn báº£n thÃ´ pháº£i Ä‘Æ°á»£c lÃ m sáº¡ch Ä‘á»ƒ trÃ¡nh nhiá»…u vector:

- **Header/Footer:** XÃ³a cÃ¡c dÃ²ng `--- PAGE X ---`, `Cá»˜NG HÃ’A XÃƒ Há»˜I...`.
- **Ghi chÃº cuá»‘i trang (Footnotes):**
  - _Nháº­n diá»‡n:_ CÃ¡c dÃ²ng báº¯t Ä‘áº§u báº±ng sá»‘ nhá» (VD: `1`, `2`) hoáº·c kÃ½ tá»± Ä‘áº·c biá»‡t á»Ÿ cuá»‘i trang, thÆ°á»ng giáº£i thÃ­ch nguá»“n gá»‘c sá»­a Ä‘á»•i luáº­t.
  - _HÃ nh Ä‘á»™ng:_ TÃ¡ch riÃªng ra khá»i ná»™i dung chÃ­nh cá»§a Äiá»u luáº­t.
  - _LÆ°u trá»¯:_ Náº¿u quan trá»ng, lÆ°u vÃ o trÆ°á»ng metadata `footnotes` hoáº·c `amendment_history`. Náº¿u khÃ´ng, xÃ³a bá» Ä‘á»ƒ trÃ¡nh lÃ m loÃ£ng ngá»¯ nghÄ©a.
- **Source Tags:** XÃ³a cÃ¡c tháº» \`\` trong vÄƒn báº£n (náº¿u file gá»‘c cÃ³).

#### 2\. Logic PhÃ¢n cáº¥p (Hierarchy State Machine)

Script cháº¡y tuáº§n tá»± (Stateful parsing):

- Gáº·p `ChÆ°Æ¡ng X`: $\rightarrow$ Set `current_chapter_id = X`, `current_chapter_title = ...`. **QUAN TRá»ŒNG:** Reset `section` vá» `null` (Ä‘á»ƒ xá»­ lÃ½ trÆ°á»ng há»£p chÆ°Æ¡ng má»›i khÃ´ng cÃ³ má»¥c).
- Gáº·p `Má»¥c Y`: $\rightarrow$ Set `current_section_id = Y`, `current_section_title = ...`.
- Gáº·p `Äiá»u Z`: $\rightarrow$ Báº¯t Ä‘áº§u logic cáº¯t Chunk cho Äiá»u Z.

#### 3\. Logic Cáº¯t Chunk (Recursive Contextual Splitting)

ChÃºng ta Ã¡p dá»¥ng logic **"Recursive Stemming"** (Ná»‘i gá»‘c Ä‘á»‡ quy) Ä‘á»ƒ xá»­ lÃ½ má»i trÆ°á»ng há»£p lá»i dáº«n.

- **BÆ°á»›c 1: XÃ¡c Ä‘á»‹nh cáº¥u trÃºc Äiá»u luáº­t**

  - Náº¿u Ä‘á»™ dÃ i \< 2000 kÃ½ tá»± vÃ  khÃ´ng cÃ³ danh sÃ¡ch liá»‡t kÃª dÃ i $\rightarrow$ **Giá»¯ nguyÃªn (Full Article Chunk)**.
  - Náº¿u Ä‘á»™ dÃ i \> 2000 kÃ½ tá»± HOáº¶C chá»©a danh sÃ¡ch dÃ i (VD: Äiá»u 79) $\rightarrow$ **Cáº¯t nhá» (Clause/Point Chunk)**.

- **BÆ°á»›c 2: Xá»­ lÃ½ Cáº¯t nhá» (Cho trÆ°á»ng há»£p Äiá»u dÃ i)**

  - **TÃ¡ch Lá»i dáº«n cáº¥p Äiá»u (Article Preamble):**
    - Kiá»ƒm tra cÃ³ lá»i dáº«n Ä‘iá»u hay khÃ´ng
    - Ná»™i dung tá»« sau `TiÃªu Ä‘á» Äiá»u` Ä‘áº¿n trÆ°á»›c `Khoáº£n 1` (hoáº·c dáº¥u hiá»‡u liá»‡t kÃª Ä‘áº§u tiÃªn).
    - _VÃ­ dá»¥:_ "NhÃ  nÆ°á»›c thu há»“i Ä‘áº¥t trong trÆ°á»ng há»£p tháº­t cáº§n thiáº¿t... sau Ä‘Ã¢y:"
  - **Cáº¯t tá»«ng Khoáº£n (Clause):**
    - Duyá»‡t qua tá»«ng Khoáº£n (1, 2, 3...).
    - Kiá»ƒm tra trong Khoáº£n cÃ³ **Lá»i dáº«n cáº¥p Khoáº£n (Clause Preamble)** khÃ´ng? (VD: "1. ...gá»“m cÃ¡c giáº¥y tá» sau: a)... b)...").
    - **Náº¿u KHÃ”NG cÃ³ Ä‘iá»ƒm a, b, c:**
      - `Chunk Content = [TiÃªu Ä‘á» Äiá»u] + [Lá»i dáº«n Äiá»u] + [Ná»™i dung Khoáº£n]`.
    - **Náº¿u CÃ“ Ä‘iá»ƒm a, b, c (Cáº¯t sÃ¢u hÆ¡n):**
      - TÃ¡ch `Lá»i dáº«n Khoáº£n` (tá»« Ä‘áº§u Khoáº£n Ä‘áº¿n trÆ°á»›c Ä‘iá»ƒm a).
      - Táº¡o chunk cho tá»«ng Ä‘iá»ƒm:
      - `Chunk Content = [TiÃªu Ä‘á» Äiá»u] + [Lá»i dáº«n Äiá»u] + [Lá»i dáº«n Khoáº£n] + [Ná»™i dung Äiá»ƒm a]`.

- Xá»­ lÃ½ trÆ°á»ng há»£p ghÃ©p trang (má»™t Ä‘iá»u/khoáº£n náº±m giá»¯a 2 trang).

---

### ğŸ“‹ PHáº¦N 2: METADATA SCHEMA (Cáº¤U TRÃšC Dá»® LIá»†U)

Báº£ng cáº¥u trÃºc dá»¯ liá»‡u cáº­p nháº­t Ä‘áº§y Ä‘á»§ cÃ¡c trÆ°á»ng cáº§n thiáº¿t:

| Field Name      | Type      | Nullable | MÃ´ táº£ / Má»¥c Ä‘Ã­ch                                       |
| :-------------- | :-------- | :------- | :----------------------------------------------------- |
| **Hierarchy**   |           |          |                                                        |
| `law_id`        | String    | No       | ID vÄƒn báº£n (VD: `133/VBHN-VPQH`).                      |
| `chapter_id`    | Integer   | No       | Sá»‘ thá»© tá»± ChÆ°Æ¡ng (VD: `6`).                            |
| `chapter_title` | String    | No       | TÃªn ChÆ°Æ¡ng.                                            |
| `section_id`    | Integer   | **Yes**  | Sá»‘ thá»© tá»± Má»¥c. **Äá»ƒ `null` náº¿u chÆ°Æ¡ng khÃ´ng cÃ³ má»¥c.**  |
| `section_title` | String    | **Yes**  | TÃªn Má»¥c.                                               |
| `article_id`    | String    | No       | Sá»‘ hiá»‡u Äiá»u (VD: `79`).                               |
| `clause_id`     | String    | **Yes**  | Sá»‘ hiá»‡u Khoáº£n (VD: `1`). Chá»‰ cÃ³ khi cáº¯t nhá».           |
| `point_id`      | String    | **Yes**  | Sá»‘ hiá»‡u Äiá»ƒm (VD: `a`). Chá»‰ cÃ³ khi cáº¯t sÃ¢u xuá»‘ng Ä‘iá»ƒm. |
| **Content**     |           |          |                                                        |
| `article_title` | String    | No       | TiÃªu Ä‘á» Äiá»u.                                          |
| `topic`         | String    | No       | Chá»§ Ä‘á» chÃ­nh (VD: `thu_hoi_dat`). DÃ¹ng Ä‘á»ƒ filter.      |
| `chunk_type`    | String    | No       | GiÃ¡ trá»‹: `full_article`, `clause`, hoáº·c `point`.       |
| **Source**      |           |          |                                                        |
| `page_number`   | List[Int] | No       | Danh sÃ¡ch trang PDF (VD: `[61, 62]`).                  |
| `file_path`     | String    | No       | ÄÆ°á»ng dáº«n file gá»‘c.                                    |
| `coordinates`   | JSON      | No       | Tá»a Ä‘á»™ `[x, y, w, h]` Ä‘á»ƒ váº½ highlight.                 |
| `footnotes`     | String    | **Yes**  | Ná»™i dung ghi chÃº cuá»‘i trang liÃªn quan (náº¿u cÃ³).        |

---

### ğŸ’¾ PHáº¦N 3: DATA SAMPLE (MáºªU Dá»® LIá»†U JSON)

#### Máº«u 1: Äiá»u luáº­t SiÃªu dÃ i + CÃ³ Lá»i dáº«n cáº¥p Äiá»u (VD: Äiá»u 79, Khoáº£n 27)

_Ngá»¯ cáº£nh: Äiá»u 79, ChÆ°Æ¡ng VI (khÃ´ng cÃ³ Má»¥c)._

```json
{
  "id": "law_133_art_79_clause_27",
  "text": "Äiá»u 79. Thu há»“i Ä‘áº¥t Ä‘á»ƒ phÃ¡t triá»ƒn kinh táº¿ - xÃ£ há»™i vÃ¬ lá»£i Ã­ch quá»‘c gia, cÃ´ng cá»™ng. NhÃ  nÆ°á»›c thu há»“i Ä‘áº¥t trong trÆ°á»ng há»£p tháº­t cáº§n thiáº¿t Ä‘á»ƒ thá»±c hiá»‡n dá»± Ã¡n phÃ¡t triá»ƒn kinh táº¿ - xÃ£ há»™i vÃ¬ lá»£i Ã­ch quá»‘c gia, cÃ´ng cá»™ng nháº±m phÃ¡t huy nguá»“n lá»±c Ä‘áº¥t Ä‘ai... trong trÆ°á»ng há»£p sau Ä‘Ã¢y: Khoáº£n 27. Thá»±c hiá»‡n dá»± Ã¡n Ä‘áº§u tÆ° xÃ¢y dá»±ng khu Ä‘Ã´ thá»‹ cÃ³ cÃ´ng nÄƒng phá»¥c vá»¥ há»—n há»£p...",
  "metadata": {
    "law_id": "133/VBHN-VPQH",
    "chapter_id": 6,
    "chapter_title": "THU Há»’I Äáº¤T, TRÆ¯NG Dá»¤NG Äáº¤T",
    "section_id": null,
    "section_title": "",
    "article_id": "79",
    "article_title": "Thu há»“i Ä‘áº¥t Ä‘á»ƒ phÃ¡t triá»ƒn kinh táº¿ - xÃ£ há»™i...",
    "clause_id": "27",
    "point_id": null,
    "chunk_type": "clause",
    "topic": "thu_hoi_dat",
    "page_number": [62],
    "file_path": "/data/133.pdf",
    "coordinates": [{ "page": 62, "rect": [50, 400, 500, 150] }],
    "footnotes": ""
  }
}
```

#### Máº«u 2: Äiá»u luáº­t Phá»©c táº¡p + CÃ³ Lá»i dáº«n cáº¥p Khoáº£n (VD: Äiá»u 137, Khoáº£n 1, Äiá»ƒm a)

_Ngá»¯ cáº£nh: Cáº¯t sÃ¢u xuá»‘ng táº­n Ä‘iá»ƒm a Ä‘á»ƒ Ä‘áº£m báº£o chÃ­nh xÃ¡c._

```json
{
  "id": "law_133_art_137_clause_1_point_a",
  "text": "Äiá»u 137. Cáº¥p Giáº¥y chá»©ng nháº­n quyá»n sá»­ dá»¥ng Ä‘áº¥t... Khoáº£n 1. Há»™ gia Ä‘Ã¬nh, cÃ¡ nhÃ¢n Ä‘ang sá»­ dá»¥ng Ä‘áº¥t á»•n Ä‘á»‹nh mÃ  cÃ³ má»™t trong cÃ¡c loáº¡i giáº¥y tá» Ä‘Æ°á»£c láº­p trÆ°á»›c ngÃ y 15 thÃ¡ng 10 nÄƒm 1993 sau Ä‘Ã¢y thÃ¬ Ä‘Æ°á»£c cáº¥p Giáº¥y chá»©ng nháº­n...: a) Nhá»¯ng giáº¥y tá» vá» quyá»n Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘áº¥t do cÆ¡ quan cÃ³ tháº©m quyá»n cáº¥p trong quÃ¡ trÃ¬nh thá»±c hiá»‡n chÃ­nh sÃ¡ch Ä‘áº¥t Ä‘ai...",
  "metadata": {
    "law_id": "133/VBHN-VPQH",
    "chapter_id": 10,
    "chapter_title": "ÄÄ‚NG KÃ Äáº¤T ÄAI...",
    "section_id": 3,
    "section_title": "Cáº¤P GIáº¤Y CHá»¨NG NHáº¬N...",
    "article_id": "137",
    "article_title": "Cáº¥p Giáº¥y chá»©ng nháº­n... cÃ³ giáº¥y tá»...",
    "clause_id": "1",
    "point_id": "a",
    "chunk_type": "point",
    "topic": "cap_so_do",
    "page_number": [113],
    "file_path": "/data/133.pdf",
    "coordinates": [{ "page": 113, "rect": [50, 100, 500, 50] }]
  }
}
```

# Code sample

```python
import fitz  # PyMuPDF
import re
import json


class LandLawChunkerFinal:
    def __init__(self, pdf_path):
        self.pdf_path = pdf_path
        try:
            self.doc = fitz.open(pdf_path)
        except Exception as e:
            raise ValueError(f"KhÃ´ng thá»ƒ má»Ÿ file PDF: {e}")

        self.law_id = "133/VBHN-VPQH"
        self.chunks = []

        # State variables (Hierarchy)
        self.current_chapter = {"id": None, "title": None}
        self.current_section = {"id": None, "title": None}

    def clean_text_for_embedding(self, text):
        """
        LÃ m sáº¡ch text triá»‡t Ä‘á»ƒ Ä‘á»ƒ lÆ°u vÃ o DB (dÃ¹ng cho semantic search).
        """
        # 1. XÃ³a Ä‘Ã¡nh dáº¥u trang vÃ  header/footer cá»‘ Ä‘á»‹nh
        # XÃ³a dÃ²ng "--- PAGE 123 ---"
        text = re.sub(r"--- PAGE \d+ ---", "", text)
        text = re.sub(r"Cá»˜NG HÃ’A XÃƒ Há»˜I CHá»¦ NGHÄ¨A VIá»†T NAM", "", text)
        text = re.sub(r"Äá»™c láº­p - Tá»± do - Háº¡nh phÃºc", "", text)

        # 2. XÃ³a Footnote/Source Tags (FIXED)
        # File cá»§a báº¡n chá»©a cÃ¡c tag nhÆ° , ...
        # Regex: \[ (dáº¥u ngoáº·c vuÃ´ng má»Ÿ), source:, \s* (khoáº£ng tráº¯ng tÃ¹y Ã½), \d+ (sá»‘), \] (dáº¥u ngoáº·c vuÃ´ng Ä‘Ã³ng)
        text = re.sub(r"\[source:\s*\d+\]", "", text)

        # 3. Ná»‘i dÃ²ng (Text Reconstruction)
        # Thay tháº¿ xuá»‘ng dÃ²ng Ä‘Æ¡n láº» báº±ng khoáº£ng tráº¯ng (Ä‘á»ƒ ná»‘i cÃ¢u bá»‹ ngáº¯t)
        # Giá»¯ láº¡i xuá»‘ng dÃ²ng kÃ©p (Ä‘á»ƒ tÃ¡ch Ä‘oáº¡n)
        text = re.sub(r"(?<!\n)\n(?!\n)", " ", text)

        # 4. Chuáº©n hÃ³a khoáº£ng tráº¯ng (xÃ³a tab, space thá»«a)
        text = re.sub(r"\s+", " ", text)

        return text.strip()

    def get_coordinates_fuzzy(self, search_text):
        """
        TÃ¬m tá»a Ä‘á»™ text trong PDF gá»‘c báº±ng Fuzzy Search.
        Chiáº¿n lÆ°á»£c: Chá»‰ tÃ¬m kiáº¿m má»™t Ä‘oáº¡n ngáº¯n Ä‘áº·c trÆ°ng (Signature Phrase) á»Ÿ Ä‘áº§u chunk.
        """
        if not search_text:
            return [], []

        # Láº¥y 60 kÃ½ tá»± Ä‘áº§u tiÃªn cá»§a ná»™i dung thá»±c (Bá» qua pháº§n TiÃªu Ä‘á» Äiá»u/Khoáº£n Ä‘Ã£ Ä‘Æ°á»£c ná»‘i vÃ o)
        # VÃ¬ TiÃªu Ä‘á» Äiá»u láº·p láº¡i á»Ÿ má»i chunk con, tÃ¬m theo tiÃªu Ä‘á» sáº½ ra sai vá»‹ trÃ­.

        # LÃ m sáº¡ch sÆ¡ bá»™ search_text Ä‘á»ƒ tÄƒng kháº£ nÄƒng match (chá»‰ bá» xuá»‘ng dÃ²ng thá»«a)
        clean_search_key = re.sub(r"\s+", " ", search_text).strip()
        search_phrase = clean_search_key[:50]  # Láº¥y 50 kÃ½ tá»± Ä‘áº§u lÃ m key

        locations = []
        pages_found = set()

        # QuÃ©t toÃ n bá»™ document (CÃ³ thá»ƒ tá»‘i Æ°u báº±ng cÃ¡ch giá»›i háº¡n range náº¿u biáº¿t trÆ°á»›c)
        for i, page in enumerate(self.doc):
            # search_for tráº£ vá» list cÃ¡c Rect (x0, y0, x1, y1)
            quads = page.search_for(search_phrase)

            if quads:
                pages_found.add(i + 1)
                for q in quads:
                    locations.append(
                        {
                            "page": i + 1,
                            # LÃ m trÃ²n 2 sá»‘ láº» Ä‘á»ƒ giáº£m dung lÆ°á»£ng JSON output
                            "rect": [
                                round(q.x0, 2),
                                round(q.y0, 2),
                                round(q.x1, 2),
                                round(q.y1, 2),
                            ],
                        }
                    )
                # Náº¿u tÃ¬m tháº¥y rá»“i thÃ¬ break Ä‘á»ƒ tiáº¿t kiá»‡m thá»i gian (Giáº£ Ä‘á»‹nh text lÃ  unique trong ngá»¯ cáº£nh cá»¥c bá»™)
                # break

        return list(pages_found), locations

    def recursive_split(self, article_dict):
        """
        Chiáº¿n lÆ°á»£c: Recursive Stemming + Adaptive Chunking
        Input: Article Object (Title, Content)
        Output: List of Chunks
        """
        full_text = article_dict["content"]
        article_title = article_dict["title"]  # VD: "Äiá»u 79. Thu há»“i Ä‘áº¥t..."
        article_id = article_dict["id"]

        # Regex tÃ¬m khoáº£n: "1. ", "2. " á»Ÿ Ä‘áº§u dÃ²ng hoáº·c sau dáº¥u xuá»‘ng dÃ²ng
        clause_pattern = r"(?m)(^|\n)(\d+)\.\s"
        matches = list(re.finditer(clause_pattern, full_text))

        # --- LOGIC 1: ÄIá»€U KIá»†N Cáº®T (ADAPTIVE) ---
        # Cáº¯t náº¿u: DÃ i > 1500 kÃ½ tá»± HOáº¶C cÃ³ > 5 khoáº£n (giáº£m ngÆ°á»¡ng xuá»‘ng 5 Ä‘á»ƒ an toÃ n hÆ¡n)
        should_split = len(full_text) > 1500 or len(matches) > 5

        if not should_split:
            # Case A: Giá»¯ nguyÃªn (Full Article Chunk)

            # 1. Táº¡o text sáº¡ch Ä‘á»ƒ lÆ°u DB
            final_db_text = self.clean_text_for_embedding(
                f"{article_title} {full_text}"
            )

            # 2. TÃ¬m tá»a Ä‘á»™ (DÃ¹ng text gá»‘c chÆ°a clean quÃ¡ nhiá»u Ä‘á»ƒ dá»… match)
            # Láº¥y 100 kÃ½ tá»± Ä‘áº§u cá»§a ná»™i dung Äiá»u lÃ m key tÃ¬m kiáº¿m
            search_key = full_text[:100]
            pgs, coords = self.get_coordinates_fuzzy(search_key)

            return [
                {
                    "id": f"law_{self.law_id}_art_{article_id}",
                    "text": final_db_text,
                    "metadata": {
                        **article_dict["metadata"],
                        "chunk_type": "full_article",
                        "clause_id": None,
                        "point_id": None,
                        "page_number": pgs,
                        "coordinates": coords,
                    },
                }
            ]

        # Case B: Cáº¯t nhá» (Recursive Logic)
        results = []

        # 1. TÃ¡ch Preamble (Lá»i dáº«n) cáº¥p Äiá»u
        if matches:
            first_match_start = matches[0].start()
            article_preamble = full_text[:first_match_start].strip()
        else:
            article_preamble = ""

        # Duyá»‡t qua tá»«ng khoáº£n
        for i, match in enumerate(matches):
            clause_id = match.group(2)
            start = match.end()
            # Äiá»ƒm cuá»‘i lÃ  Ä‘iá»ƒm Ä‘áº§u cá»§a khoáº£n tiáº¿p theo, hoáº·c háº¿t vÄƒn báº£n
            end = matches[i + 1].start() if i + 1 < len(matches) else len(full_text)
            clause_content = full_text[start:end].strip()

            # --- LOGIC 2: Xá»¬ LÃ ÄIá»‚M (ADAPTIVE SUB-SPLITTING) ---
            # ThÃªm 'Ä‘' vÃ o regex cho tiáº¿ng Viá»‡t
            point_pattern = r"(?m)(^|\n|\s)([a-zÄ‘])\)\s"
            point_matches = list(re.finditer(point_pattern, clause_content))

            # Äiá»u kiá»‡n tÃ¡ch Ä‘iá»ƒm: CÃ³ Ä‘iá»ƒm VÃ€ (Nhiá»u Ä‘iá»ƒm > 5 HOáº¶C Ná»™i dung quÃ¡ dÃ i > 800)
            has_points = len(point_matches) > 0
            should_split_points = has_points and (
                len(point_matches) > 5 or len(clause_content) > 800
            )

            if not should_split_points:
                # TRÆ¯á»œNG Há»¢P Gá»˜P (MERGE): Táº¡o Chunk cáº¥p Khoáº£n

                # Prepend context: TiÃªu Ä‘á» + Lá»i dáº«n Äiá»u
                # LÆ°u Ã½: article_preamble cáº§n Ä‘Æ°á»£c clean nháº¹ Ä‘á»ƒ ná»‘i chuá»—i Ä‘áº¹p hÆ¡n
                clean_art_preamble = self.clean_text_for_embedding(article_preamble)

                full_chunk_text = f"{article_title} {clean_art_preamble} Khoáº£n {clause_id}. {clause_content}"
                final_db_text = self.clean_text_for_embedding(full_chunk_text)

                # TÃ¬m tá»a Ä‘á»™: DÃ¹ng ná»™i dung gá»‘c cá»§a khoáº£n Ä‘á»ƒ tÃ¬m
                pgs, coords = self.get_coordinates_fuzzy(clause_content[:100])

                results.append(
                    {
                        "id": f"law_{self.law_id}_art_{article_id}_clause_{clause_id}",
                        "text": final_db_text,
                        "metadata": {
                            **article_dict["metadata"],
                            "chunk_type": "clause",
                            "clause_id": clause_id,
                            "point_id": None,
                            "page_number": pgs,
                            "coordinates": coords,
                            "has_points": has_points,  # Flag Ä‘Ã¡nh dáº¥u
                        },
                    }
                )
            else:
                # TRÆ¯á»œNG Há»¢P TÃCH (SPLIT): Cáº¯t sÃ¢u xuá»‘ng cáº¥p Äiá»ƒm

                # TÃ¡ch Preamble cáº¥p Khoáº£n
                clause_preamble = clause_content[: point_matches[0].start()].strip()
                clean_clause_preamble = self.clean_text_for_embedding(clause_preamble)
                clean_art_preamble = self.clean_text_for_embedding(article_preamble)

                for j, p_match in enumerate(point_matches):
                    point_id = p_match.group(2)
                    p_start = p_match.end()
                    p_end = (
                        point_matches[j + 1].start()
                        if j + 1 < len(point_matches)
                        else len(clause_content)
                    )
                    point_content = clause_content[p_start:p_end].strip()

                    # Táº¡o Chunk Äiá»ƒm (Full Context)
                    # Prepend context: TiÃªu Ä‘á» + Lá»i dáº«n Äiá»u + Khoáº£n sá»‘ + Lá»i dáº«n Khoáº£n
                    full_chunk_text = f"{article_title} {clean_art_preamble} Khoáº£n {clause_id}. {clean_clause_preamble} Äiá»ƒm {point_id}) {point_content}"
                    final_db_text = self.clean_text_for_embedding(full_chunk_text)

                    # TÃ¬m tá»a Ä‘á»™ Ä‘iá»ƒm
                    pgs, coords = self.get_coordinates_fuzzy(point_content[:100])

                    results.append(
                        {
                            "id": f"law_{self.law_id}_art_{article_id}_clause_{clause_id}_point_{point_id}",
                            "text": final_db_text,
                            "metadata": {
                                **article_dict["metadata"],
                                "chunk_type": "point",
                                "clause_id": clause_id,
                                "point_id": point_id,
                                "page_number": pgs,
                                "coordinates": coords,
                            },
                        }
                    )

        return results

    def process(self):
        print(f"ğŸš€ Báº¯t Ä‘áº§u xá»­ lÃ½ file: {self.pdf_path}")

        full_text = ""
        # 1. Gá»™p trang Ä‘á»ƒ xá»­ lÃ½ ná»™i dung liá»n máº¡ch
        for page in self.doc:
            full_text += page.get_text() + "\n"

        # 2. Pattern báº¯t cÃ¡c tiÃªu Ä‘á» cáº¥u trÃºc (Hierarchy)
        # Regex nÃ y tÃ¬m dÃ²ng báº¯t Ä‘áº§u báº±ng ChÆ°Æ¡ng, Má»¥c hoáº·c Äiá»u
        hierarchy_pattern = (
            r"(?m)^(ChÆ°Æ¡ng\s+[IVXLCDM]+|Má»¥c\s+\d+|Äiá»u\s+(\d+)\.)\s+(.*)"
        )

        matches = list(re.finditer(hierarchy_pattern, full_text))
        print(f"ğŸ” TÃ¬m tháº¥y {len(matches)} Ä‘iá»ƒm Ä‘Ã¡nh dáº¥u cáº¥u trÃºc.")

        for i, match in enumerate(matches):
            marker_type = match.group(1)  # ChÆ°Æ¡ng I, Má»¥c 1, Äiá»u 1.
            content_title = match.group(3).strip()

            start_idx = match.end()
            # Ná»™i dung káº¿t thÃºc táº¡i Ä‘iá»ƒm báº¯t Ä‘áº§u cá»§a match tiáº¿p theo, hoáº·c háº¿t vÄƒn báº£n
            end_idx = matches[i + 1].start() if i + 1 < len(matches) else len(full_text)
            content_body = full_text[start_idx:end_idx].strip()

            # --- Cáº¬P NHáº¬T TRáº NG THÃI (State Machine) ---
            if marker_type.startswith("ChÆ°Æ¡ng"):
                parts = marker_type.split()
                c_id = parts[1] if len(parts) > 1 else "Unknown"
                self.current_chapter = {"id": c_id, "title": content_title}
                self.current_section = {
                    "id": None,
                    "title": None,
                }  # RESET SECTION QUAN TRá»ŒNG

            elif marker_type.startswith("Má»¥c"):
                parts = marker_type.split()
                s_id = parts[1] if len(parts) > 1 else "Unknown"
                self.current_section = {"id": s_id, "title": content_title}

            elif marker_type.startswith("Äiá»u"):
                art_id = match.group(2)  # Capture sá»‘ Ä‘iá»u (group 2 trong regex)
                full_art_title = f"{marker_type} {content_title}"

                # Metadata cho Äiá»u
                meta = {
                    "law_id": self.law_id,
                    "chapter_id": self.current_chapter["id"],
                    "chapter_title": self.current_chapter["title"],
                    "section_id": self.current_section["id"],
                    "section_title": self.current_section["title"],
                    "article_id": art_id,
                    "article_title": full_art_title,
                    "topic": "legal_document",  # Placeholder
                    "source_file": self.pdf_path.split("/")[-1],
                    "footnotes": "",  # Placeholder cho tÆ°Æ¡ng lai
                }

                # Gá»i hÃ m cáº¯t
                chunks = self.recursive_split(
                    {
                        "id": art_id,
                        "title": full_art_title,
                        "content": content_body,
                        "metadata": meta,
                    }
                )
                self.chunks.extend(chunks)

        print(f"âœ… HoÃ n thÃ nh! Tá»•ng cá»™ng {len(self.chunks)} chunks Ä‘Æ°á»£c táº¡o ra.")
        return self.chunks


# ==========================================
# TEST RUNNER (Äá»ƒ báº¡n cháº¡y thá»­)
# ==========================================
if __name__ == "__main__":
    # Thay tÃªn file PDF cá»§a báº¡n vÃ o Ä‘Ã¢y
    PDF_FILE = "133-vbhn-vpqh.pdf"

    try:
        parser = LandLawChunkerFinal(PDF_FILE)
        final_data = parser.process()

        # Xuáº¥t káº¿t quáº£
        OUTPUT_FILE = "land_law_chunks_final.json"
        with open(OUTPUT_FILE, "w", encoding="utf-8") as f:
            json.dump(final_data, f, ensure_ascii=False, indent=2)

        print(f"ğŸ’¾ Dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c lÆ°u vÃ o: {OUTPUT_FILE}")

    except Exception as e:
        print(f"âŒ Lá»—i: {e}")

```

# Checklist kiá»ƒm tra

ChÃ o báº¡n, Ä‘Ã¢y lÃ  bá»™ **Test Cases chuyÃªn biá»‡t** Ä‘á»ƒ kiá»ƒm tra logic cá»§a script Chunking (Data Ingestion). Má»¥c tiÃªu lÃ  Ä‘áº£m báº£o dá»¯ liá»‡u Ä‘áº§u ra (JSON) sáº¡ch, Ä‘Ãºng cáº¥u trÃºc vÃ  Ä‘áº§y Ä‘á»§ ngá»¯ nghÄ©a trÆ°á»›c khi náº¡p vÃ o Vector DB.

Báº¡n hÃ£y sá»­ dá»¥ng bá»™ test nÃ y Ä‘á»ƒ `print()` hoáº·c `assert` káº¿t quáº£ tá»« script Python cá»§a mÃ¬nh.

### ğŸ“‹ Tá»”NG QUAN CHIáº¾N LÆ¯á»¢C TEST

ChÃºng ta sáº½ kiá»ƒm tra 5 ká»‹ch báº£n (scenarios) Ä‘áº¡i diá»‡n cho cÃ¡c cáº¥u trÃºc vÄƒn báº£n khÃ³ nháº¥t trong file PDF Luáº­t Äáº¥t Ä‘ai:

1.  **Simple Article:** Äiá»u luáº­t ngáº¯n, chuáº©n.
2.  **Long List Article:** Äiá»u luáº­t liá»‡t kÃª dÃ i (cÃ³ Lá»i dáº«n cáº¥p Äiá»u).
3.  **Nested Article:** Äiá»u luáº­t lá»“ng ghÃ©p (cÃ³ Lá»i dáº«n cáº¥p Khoáº£n).
4.  **Page Break:** Äiá»u luáº­t bá»‹ ngáº¯t trang.
5.  **Metadata Hierarchy:** Kiá»ƒm tra cáº¥u trÃºc ChÆ°Æ¡ng/Má»¥c.

---

### ğŸ§ª TEST CASE 1: ÄIá»€U LUáº¬T CHUáº¨N (STANDARD)

_Kiá»ƒm tra xem cÃ¡c Ä‘iá»u luáº­t ngáº¯n cÃ³ bá»‹ cáº¯t vá»¥n khÃ´ng cáº§n thiáº¿t hay khÃ´ng._

- [cite\_start]**Input Target:** **Äiá»u 15** (TrÃ¡ch nhiá»‡m cá»§a NhÃ  nÆ°á»›c Ä‘á»‘i vá»›i ngÆ°á»i sá»­ dá»¥ng Ä‘áº¥t) [cite: 244-250].
- **Ká»³ vá»ng (Expected Result):**
  - **Sá»‘ lÆ°á»£ng Chunk:** 1 chunk duy nháº¥t.
  - **Ná»™i dung:** Pháº£i chá»©a toÃ n bá»™ ná»™i dung tá»« Khoáº£n 1 Ä‘áº¿n Khoáº£n 5.
  - **Metadata:** `chunk_type` = "full_article".

### ğŸ§ª TEST CASE 2: ÄIá»€U LUáº¬T LIá»†T KÃŠ DÃ€I (PREAMBLE Cáº¤P ÄIá»€U)

_Kiá»ƒm tra ká»¹ thuáº­t "Prepend" (Ná»‘i Ä‘áº§u) cho cÃ¡c Ä‘iá»u luáº­t cÃ³ danh sÃ¡ch dÃ i._

- [cite\_start]**Input Target:** **Äiá»u 79** (Thu há»“i Ä‘áº¥t...) - Cá»¥ thá»ƒ lÃ  **Khoáº£n 27** [cite: 1184][cite\_start],[cite: 1260].
- **Ká»³ vá»ng (Expected Result):**
  - **Sá»‘ lÆ°á»£ng Chunk:** Äiá»u 79 pháº£i Ä‘Æ°á»£c tÃ¡ch thÃ nh Ã­t nháº¥t 32 chunks (tÆ°Æ¡ng á»©ng 32 khoáº£n).
  - **Ná»™i dung Chunk 27:** Báº®T BUá»˜C pháº£i báº¯t Ä‘áº§u báº±ng chuá»—i:
    > _"Äiá»u 79. Thu há»“i Ä‘áº¥t Ä‘á»ƒ phÃ¡t triá»ƒn kinh táº¿ - xÃ£ há»™i... NhÃ  nÆ°á»›c thu há»“i Ä‘áº¥t trong trÆ°á»ng há»£p tháº­t cáº§n thiáº¿t... trong trÆ°á»ng há»£p sau Ä‘Ã¢y: Khoáº£n 27. Thá»±c hiá»‡n dá»± Ã¡n Ä‘áº§u tÆ° xÃ¢y dá»±ng khu Ä‘Ã´ thá»‹..."_
  - **Lá»—i cáº§n trÃ¡nh:** Chunk chá»‰ báº¯t Ä‘áº§u báº±ng _"27. Thá»±c hiá»‡n dá»± Ã¡n..."_ (Máº¥t ngá»¯ cáº£nh thu há»“i Ä‘áº¥t).

### ğŸ§ª TEST CASE 3: ÄIá»€U LUáº¬T Lá»’NG GHÃ‰P (PREAMBLE Cáº¤P KHOáº¢N)

_Kiá»ƒm tra logic Ä‘á»‡ quy (Recursive) khi cáº¯t sÃ¢u xuá»‘ng cáº¥p Äiá»ƒm (a, b, c)._

- [cite\_start]**Input Target:** **Äiá»u 137** (Cáº¥p Giáº¥y chá»©ng nháº­n...) -\> **Khoáº£n 1** -\> **Äiá»ƒm a** [cite: 2119-2120].
- **Ká»³ vá»ng (Expected Result):**
  - **Ná»™i dung Chunk:** Pháº£i lÃ  sá»± káº¿t há»£p cá»§a 3 pháº§n:
    1.  **TiÃªu Ä‘á»:** _"Äiá»u 137. Cáº¥p Giáº¥y chá»©ng nháº­n..."_
    2.  **Lá»i dáº«n Khoáº£n 1:** _"Khoáº£n 1. Há»™ gia Ä‘Ã¬nh... cÃ³ má»™t trong cÃ¡c loáº¡i giáº¥y tá»... sau Ä‘Ã¢y thÃ¬ Ä‘Æ°á»£c cáº¥p Giáº¥y chá»©ng nháº­n...:"_
    3.  **Ná»™i dung Äiá»ƒm a:** _"a) Nhá»¯ng giáº¥y tá» vá» quyá»n Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘áº¥t do cÆ¡ quan cÃ³ tháº©m quyá»n cáº¥p..."_
  - **Metadata:** `clause_id`="1", `point_id`="a".

### ğŸ§ª TEST CASE 4: Xá»¬ LÃ NGáº®T TRANG (PAGE BREAK & CLEANING)

_Kiá»ƒm tra viá»‡c ná»‘i dÃ²ng vÃ  xÃ³a Header/Footer._

- **Input Target:** **Äiá»u 79** (Chuyá»ƒn tiáº¿p tá»« trang 60 sang trang 61).
- [cite\_start]**Vá»‹ trÃ­:** Khoáº£n 14 (XÃ¢y dá»±ng cÆ¡ sá»Ÿ vÄƒn hÃ³a...) náº±m á»Ÿ cuá»‘i trang 60 [cite: 1222][cite\_start], tiáº¿p ná»‘i sang Ä‘áº§u trang 61 [cite: 1229-1230].
- **Ká»³ vá»ng (Expected Result):**
  - **Text sáº¡ch:** Trong ná»™i dung chunk cá»§a Khoáº£n 14, **KHÃ”NG** Ä‘Æ°á»£c xuáº¥t hiá»‡n cÃ¡c chuá»—i:
    - `--- PAGE 60 ---`
    - `--- PAGE 61 ---`
    - `60` (Sá»‘ trang Ä‘Æ¡n láº»)
  - **Liá»n máº¡ch:** CÃ¢u vÄƒn khÃ´ng bá»‹ ngáº¯t quÃ£ng. VÃ­ dá»¥: _"cÆ¡ sá»Ÿ sÃ¡ng tÃ¡c vÄƒn há»c, cÆ¡ sá»Ÿ sÃ¡ng tÃ¡c nghá»‡ thuáº­t..."_ pháº£i liá»n máº¡ch, khÃ´ng bá»‹ chÃ¨n kÃ½ tá»± láº¡.

### ğŸ§ª TEST CASE 5: PHÃ‚N Cáº¤P METADATA (HIERARCHY)

_Kiá»ƒm tra logic State Machine nháº­n diá»‡n ChÆ°Æ¡ng/Má»¥c._

- **Case 5.1 (CÃ³ Má»¥c):**
  - **Target:** **Äiá»u 96** (Bá»“i thÆ°á»ng vá» Ä‘áº¥t nÃ´ng nghiá»‡p...).
  - [cite\_start]**Ká»³ vá»ng Metadata:** `chapter_id`=7, `section_id`=2 (VÃ¬ Äiá»u 96 náº±m trong Má»¥c 2 ChÆ°Æ¡ng VII) [cite: 1584-1585][cite\_start],[cite: 1613].
- **Case 5.2 (KhÃ´ng cÃ³ Má»¥c):**
  - **Target:** **Äiá»u 79** (Thu há»“i Ä‘áº¥t...).
  - [cite\_start]**Ká»³ vá»ng Metadata:** `chapter_id`=6, `section_id`=`null` (VÃ¬ ChÆ°Æ¡ng VI khÃ´ng chia Má»¥c) [cite: 1164-1166].

---

### ğŸ’» MÃƒ KIá»‚M TRA NHANH (PYTHON ASSERTION)

Báº¡n cÃ³ thá»ƒ dÃ¹ng Ä‘oáº¡n code nhá» nÃ y Ä‘á»ƒ validate nhanh output JSON cá»§a mÃ¬nh:

```python
def test_chunking_logic(chunks):
    # Map chunks by ID for easy lookup
    chunk_map = {c['metadata']['article_id']: c for c in chunks}

    # Test 1: Standard Article 15
    art_15 = [c for c in chunks if c['metadata']['article_id'] == '15'][0]
    assert "TrÃ¡ch nhiá»‡m cá»§a NhÃ  nÆ°á»›c" in art_15['text']
    assert art_15['metadata']['chunk_type'] == 'full_article'
    print("âœ… Test 1 Passed: Article 15 chunked correctly.")

    # Test 2: Article 79 Preamble Check
    # TÃ¬m chunk cá»§a Khoáº£n 27
    art_79_27 = [c for c in chunks if c['metadata']['article_id'] == '79' and c['metadata'].get('clause_id') == '27'][0]
    expected_preamble = "NhÃ  nÆ°á»›c thu há»“i Ä‘áº¥t trong trÆ°á»ng há»£p tháº­t cáº§n thiáº¿t"
    assert expected_preamble in art_79_27['text'], "Missing Article 79 Preamble!"
    assert "khu Ä‘Ã´ thá»‹" in art_79_27['text']
    print("âœ… Test 2 Passed: Article 79.27 has correct context.")

    # Test 5: Hierarchy Check
    art_96 = [c for c in chunks if c['metadata']['article_id'] == '96'][0]
    art_79 = [c for c in chunks if c['metadata']['article_id'] == '79'][0]

    assert art_96['metadata']['section_id'] is not None, "Article 96 MUST have section_id"
    assert art_79['metadata']['section_id'] is None, "Article 79 MUST NOT have section_id"
    print("âœ… Test 5 Passed: Hierarchy Metadata is correct.")

# Run test
# test_chunking_logic(your_final_json_data)
```
